# M5Stack metronome for SD-Updater

![MetroN](https://user-images.githubusercontent.com/17703236/75149554-a15fee00-5745-11ea-995b-ce7e1435497c.jpg)

いわゆるメトロノーム です。

## 概要

メトロノームです。
- 5種類のパターンがあらかじめ入っています
- 3段階のボリュームの調整をなんとなくできます
- BLE MIDI 対応で、BLE MIDI 機器からメトロノームの音を出すことができます
- SD カードにコンフィギュレーションファイルがあるとそれを使います(MetroN.csv)
- コンフィギュレーションファイルで、パターンとソング及び MIDI ノート番号の指定ができます
- バッテリーが全然持ちません (Basic で 20分弱。。)
- 変拍子とか考えてないです
- M5.Speaker.tone() で音出してるけど、無理やり音量変えてます
- タイマー割り込み使ってるんで、裏で RTOS 走ってるとは思いますが、発音タイミングはまぁまぁ、、だと思います
- Plus module のエンコーダー（Jog dial）をサポートしました (2/26/'20)

そして LovyanLauncher 向けのバイナリです。

## 必要なもの

M5Burner などで LovyanLauncher 入れておいてください。SD カード (安定動作には 16MB 以下がいいらしいです)。

## 使い方

### メトロノーム画面

電源を入れると、すぐにメトロノーム画面になります
- ▲と▼と[P/S]というボタンが並んでいます
- ▲と▼はテンポを変更します
- [P/S] はメトロノーム の Play, Stop です
- ▲と▼は長押しすると+/-10ずつテンポを変更します。

他は野生のカンで。

### メインメニュー

メトロノーム画面で [P/S] を長押しするとメインメニューが現れます。

- Metronome メトロノーム画面に遷移します

- Pattern パターン選択メニューが現れます。

- Song ソング選択メニューが現れます。SD カードに MetroN.csv があり、その中でソングを設定しないとメトロノーム画面に遷移します。

- Volume ボリューム選択メニューが現れます。BLE MIDI はここで選択します。

- TAP タップテンポ検出画面に遷移します。

### タップテンポ検出画面

(TAP) ボタンをテンポに合わせて叩くと（四分音符）、目安のテンポがなんとなく設定されます。メトロノーム画面に戻って微調整してください。

### やや細かい説明

#### パターン

パターンは四分音符を 24 分割して表現されます。１パターンは 48、つまり二分音符でワンセット固定です。今のところ。
強弱を 0,1,2,3 で表現できるので、なんとなく雰囲気のあるパターンになっています。
デフォルトで5パターン入っていて、コンフィギュレーションでこれを書き換えることができます。

#### ソング

テンポとパターンのペアをソングに従って切り替えます。
デフォルトは空で、最大5つのソングを登録できます。
案外この切り替えは面倒なので重宝してます。

#### BLE MIDI

Volume->BLE MIDI をタップすると動作し始めます。M5 Metroronome という名前で検出できます。
iOS なら KORG Gadget 2 Le なんかがおすすめです。London というドラム音源を追加し、MIDI というボタンを押してみてください。
接続されるとカツカツ音が出るはずです。接続を切るには。。M5Stack の電源落として下さい（笑）

#### コンフィギュレーションファイル

MetroN.csv ファイルを SD カードのルートにおいて下さい。あれば電源立ち上がり後に一度内容を読んで設定に反映します。
パターン(P)と、ソング(S)と、MIDI Note (N) を設定できます。
書き換えたいものだけコンフィギュレーションファイルに記述して下さい。
フォーマットは以下に示すとおり。サンプルをご覧ください。

##### P パターン
P,PNAME,Pattern のフォーマットで、Pattern は48個の数値で表されます。48は二分音符相当、つまり四分音符二つ分です。
数値は0,1,2,3で数値は大きいほど大き目な音になります。

##### S ソング
S,NAME,Tempo,PNAME のフォーマットです。テンポとパターン(PNAME)を設定できます。PNAME はパターン名を指定します。

##### N MIDI Note

MIDI で鳴らす音の番号を指定します。デフォルトでは 37 が割り当てられています。

## インストール

SD カードにコピペしてください。
MetroN.bin はルートに。jpg, json フォルダーの中身は SD カードのそれぞれのフォルダーにコピーしてください。
コンフィギュレーションファイルは無くてもいいですが、用意するなら SD カードのルートに MetroN.csv を置いてください。
サンプルは csv フォルダ以下にあります。

## Licence

MIT Licence

## Author

[ttrsato](https://github.com/ttrsato)
